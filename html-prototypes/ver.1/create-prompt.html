<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptStocks - プロンプト作成</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#EF4444',
                        accent: '#10B981'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <div class="max-w-md mx-auto bg-white min-h-screen">
        <!-- Header -->
        <header class="bg-primary text-white px-4 py-3 sticky top-0 z-10">
            <div class="flex items-center justify-between">
                <button class="p-2 hover:bg-blue-600 rounded-full transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h1 class="text-xl font-bold">プロンプト作成</h1>
                <button class="bg-accent text-white px-4 py-1 rounded font-medium text-sm hover:bg-green-600 transition-colors">
                    保存
                </button>
            </div>
        </header>

        <!-- Create Mode Toggle -->
        <div class="bg-white border-b border-gray-200 px-4 py-3">
            <div class="flex bg-gray-100 rounded-lg p-1">
                <button id="template-mode" class="flex-1 text-center py-2 px-3 rounded-md text-sm font-medium bg-white text-primary shadow-sm">
                    テンプレート
                </button>
                <button id="freeform-mode" class="flex-1 text-center py-2 px-3 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700">
                    自由記述
                </button>
            </div>
        </div>

        <!-- Form Content -->
        <div class="px-4 py-4">
            <!-- Template Mode -->
            <div id="template-content" class="space-y-4">
                <!-- Template Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">テンプレート選択</label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">テンプレートを選択...</option>
                        <option value="task-analysis">タスク分析</option>
                        <option value="blog-writing">ブログ記事作成</option>
                        <option value="data-analysis">データ分析</option>
                        <option value="email-template">メール作成</option>
                        <option value="meeting-notes">会議議事録</option>
                        <option value="custom">カスタムテンプレート</option>
                    </select>
                </div>

                <!-- Template Preview -->
                <div id="template-preview" class="bg-blue-50 border border-blue-200 rounded-lg p-4 hidden">
                    <h4 class="text-sm font-medium text-blue-900 mb-2">テンプレートプレビュー</h4>
                    <div class="text-sm text-blue-800 bg-white p-3 rounded border">
                        <div id="preview-content">
                            <!-- Template content will be dynamically inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Template Fields (Dynamic) -->
                <div id="template-fields" class="space-y-4 hidden">
                    <!-- Fields will be dynamically generated based on template selection -->
                </div>
            </div>

            <!-- Free Form Mode -->
            <div id="freeform-content" class="space-y-4 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">プロンプト内容</label>
                    <textarea 
                        rows="12" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none"
                        placeholder="プロンプトの内容を自由に入力してください...&#10;&#10;例：&#10;あなたは優秀なライターです。以下の条件に従って記事を作成してください。&#10;&#10;条件：&#10;- 読みやすい文章&#10;- 具体例を含める&#10;- 結論を明確にする"
                    ></textarea>
                </div>
            </div>

            <!-- Common Fields -->
            <div class="space-y-4 mt-6">
                <!-- Title -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">タイトル <span class="text-red-500">*</span></label>
                    <input 
                        type="text" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        placeholder="プロンプトのタイトルを入力"
                    >
                </div>

                <!-- Prompt Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">プロンプトタイプ</label>
                    <div class="flex flex-wrap gap-2">
                        <label class="flex items-center">
                            <input type="radio" name="prompt-type" value="system" class="sr-only peer">
                            <span class="px-3 py-2 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-blue-500 peer-checked:text-white peer-checked:border-blue-500 text-sm">システム</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="prompt-type" value="user" class="sr-only peer" checked>
                            <span class="px-3 py-2 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-green-500 peer-checked:text-white peer-checked:border-green-500 text-sm bg-green-500 text-white border-green-500">ユーザー</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="prompt-type" value="assistant" class="sr-only peer">
                            <span class="px-3 py-2 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-orange-500 peer-checked:text-white peer-checked:border-orange-500 text-sm">アシスタント</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="prompt-type" value="custom" class="sr-only peer">
                            <span class="px-3 py-2 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-purple-500 peer-checked:text-white peer-checked:border-purple-500 text-sm">カスタム</span>
                        </label>
                    </div>
                </div>

                <!-- Category -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">カテゴリ <span class="text-red-500">*</span></label>
                    <div class="flex gap-2">
                        <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">カテゴリを選択...</option>
                            <option value="productivity">作業効率</option>
                            <option value="writing">文章作成</option>
                            <option value="analysis">分析</option>
                            <option value="communication">コミュニケーション</option>
                            <option value="other">その他</option>
                        </select>
                        <button type="button" class="px-3 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Tags -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">タグ</label>
                    <div class="flex flex-wrap gap-2 mb-2" id="tag-container">
                        <!-- Tags will be added here dynamically -->
                    </div>
                    <div class="flex gap-2">
                        <input 
                            type="text" 
                            id="tag-input"
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                            placeholder="タグを入力してEnterキー"
                        >
                        <button type="button" id="add-tag" class="px-3 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                            追加
                        </button>
                    </div>
                </div>

                <!-- Favorite Toggle -->
                <div class="flex items-center justify-between">
                    <label class="block text-sm font-medium text-gray-700">お気に入りに追加</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
            </div>

            <!-- Character Count -->
            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-600">文字数:</span>
                    <span class="font-medium" id="char-count">0 文字</span>
                </div>
                <div class="flex justify-between items-center text-sm mt-1">
                    <span class="text-gray-600">推定サイズ:</span>
                    <span class="font-medium" id="size-estimate">0 B</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 mt-6 pb-20">
                <button type="button" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition-colors">
                    下書き保存
                </button>
                <button type="button" class="flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                    保存して終了
                </button>
            </div>
        </div>
    </div>

    <!-- Template Data (Hidden) -->
    <script type="application/json" id="template-data">
    {
        "task-analysis": {
            "name": "タスク分析",
            "preview": "あなたは優秀なプロジェクトマネージャーです。以下のタスクを分析し、効率的な実行計画を作成してください。",
            "fields": [
                {"id": "context", "label": "コンテキスト", "type": "textarea", "placeholder": "プロジェクトの背景や制約を入力"},
                {"id": "task", "label": "タスク内容", "type": "textarea", "placeholder": "分析したいタスクの詳細を入力", "required": true},
                {"id": "deadline", "label": "期限", "type": "text", "placeholder": "期限があれば入力"},
                {"id": "resources", "label": "利用可能リソース", "type": "textarea", "placeholder": "人員、予算、ツールなど"}
            ]
        },
        "blog-writing": {
            "name": "ブログ記事作成",
            "preview": "読みやすく魅力的なブログ記事を書いてください。SEO対策も考慮し、読者にとって価値のあるコンテンツを作成してください。",
            "fields": [
                {"id": "topic", "label": "トピック", "type": "text", "placeholder": "記事のメインテーマ", "required": true},
                {"id": "target-audience", "label": "ターゲット読者", "type": "text", "placeholder": "想定する読者層"},
                {"id": "keywords", "label": "キーワード", "type": "text", "placeholder": "SEO対策のキーワード（カンマ区切り）"},
                {"id": "length", "label": "記事の長さ", "type": "select", "options": ["500-800文字", "800-1200文字", "1200-2000文字", "2000文字以上"]},
                {"id": "tone", "label": "文体", "type": "select", "options": ["カジュアル", "フォーマル", "専門的", "親しみやすい"]}
            ]
        },
        "data-analysis": {
            "name": "データ分析",
            "preview": "提供されたデータセットを分析し、重要な傾向とインサイトを特定してください。",
            "fields": [
                {"id": "data-type", "label": "データタイプ", "type": "select", "options": ["売上データ", "ユーザー行動", "アンケート結果", "その他"], "required": true},
                {"id": "analysis-goal", "label": "分析目的", "type": "textarea", "placeholder": "何を明らかにしたいか", "required": true},
                {"id": "data-period", "label": "データ期間", "type": "text", "placeholder": "対象期間"},
                {"id": "output-format", "label": "出力形式", "type": "select", "options": ["要約レポート", "詳細分析", "グラフ付きレポート", "プレゼンテーション用"]}
            ]
        }
    }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const templateMode = document.getElementById('template-mode');
            const freeformMode = document.getElementById('freeform-mode');
            const templateContent = document.getElementById('template-content');
            const freeformContent = document.getElementById('freeform-content');
            const templateSelect = document.querySelector('select');
            const templatePreview = document.getElementById('template-preview');
            const previewContent = document.getElementById('preview-content');
            const templateFields = document.getElementById('template-fields');
            const tagInput = document.getElementById('tag-input');
            const addTagButton = document.getElementById('add-tag');
            const tagContainer = document.getElementById('tag-container');
            const charCount = document.getElementById('char-count');
            const sizeEstimate = document.getElementById('size-estimate');

            // Template data
            const templateData = JSON.parse(document.getElementById('template-data').textContent);

            // Mode switching
            templateMode.addEventListener('click', function() {
                switchMode('template');
            });

            freeformMode.addEventListener('click', function() {
                switchMode('freeform');
            });

            function switchMode(mode) {
                if (mode === 'template') {
                    templateMode.classList.add('bg-white', 'text-primary', 'shadow-sm');
                    templateMode.classList.remove('text-gray-500');
                    freeformMode.classList.remove('bg-white', 'text-primary', 'shadow-sm');
                    freeformMode.classList.add('text-gray-500');
                    templateContent.classList.remove('hidden');
                    freeformContent.classList.add('hidden');
                } else {
                    freeformMode.classList.add('bg-white', 'text-primary', 'shadow-sm');
                    freeformMode.classList.remove('text-gray-500');
                    templateMode.classList.remove('bg-white', 'text-primary', 'shadow-sm');
                    templateMode.classList.add('text-gray-500');
                    freeformContent.classList.remove('hidden');
                    templateContent.classList.add('hidden');
                }
            }

            // Template selection
            templateSelect.addEventListener('change', function() {
                const selectedTemplate = this.value;
                if (selectedTemplate && templateData[selectedTemplate]) {
                    showTemplatePreview(templateData[selectedTemplate]);
                    generateTemplateFields(templateData[selectedTemplate].fields);
                } else {
                    hideTemplatePreview();
                    hideTemplateFields();
                }
            });

            function showTemplatePreview(template) {
                previewContent.textContent = template.preview;
                templatePreview.classList.remove('hidden');
            }

            function hideTemplatePreview() {
                templatePreview.classList.add('hidden');
            }

            function generateTemplateFields(fields) {
                templateFields.innerHTML = '';
                fields.forEach(field => {
                    const fieldDiv = document.createElement('div');
                    const label = document.createElement('label');
                    label.className = 'block text-sm font-medium text-gray-700 mb-2';
                    label.textContent = field.label + (field.required ? ' *' : '');

                    let input;
                    if (field.type === 'textarea') {
                        input = document.createElement('textarea');
                        input.rows = 3;
                        input.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none';
                    } else if (field.type === 'select') {
                        input = document.createElement('select');
                        input.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent';
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = '選択してください...';
                        input.appendChild(defaultOption);
                        
                        if (field.options) {
                            field.options.forEach(option => {
                                const optionElement = document.createElement('option');
                                optionElement.value = option;
                                optionElement.textContent = option;
                                input.appendChild(optionElement);
                            });
                        }
                    } else {
                        input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent';
                    }

                    if (field.placeholder) {
                        input.placeholder = field.placeholder;
                    }
                    input.id = field.id;

                    fieldDiv.appendChild(label);
                    fieldDiv.appendChild(input);
                    templateFields.appendChild(fieldDiv);
                });
                templateFields.classList.remove('hidden');
            }

            function hideTemplateFields() {
                templateFields.classList.add('hidden');
            }

            // Tag management
            function addTag(tagText) {
                if (tagText.trim() === '') return;
                
                const tag = document.createElement('span');
                tag.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm bg-primary text-white';
                tag.innerHTML = `
                    ${tagText.trim()}
                    <button type="button" class="ml-2 hover:text-red-200">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                `;
                
                tag.querySelector('button').addEventListener('click', function() {
                    tag.remove();
                });
                
                tagContainer.appendChild(tag);
                tagInput.value = '';
            }

            addTagButton.addEventListener('click', function() {
                addTag(tagInput.value);
            });

            tagInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag(this.value);
                }
            });

            // Character count
            function updateCharCount() {
                const textarea = document.querySelector('textarea');
                if (textarea) {
                    const text = textarea.value;
                    const count = text.length;
                    const bytes = new Blob([text]).size;
                    
                    charCount.textContent = `${count} 文字`;
                    sizeEstimate.textContent = `${bytes} B`;
                }
            }

            // Add event listeners for character counting
            document.addEventListener('input', function(e) {
                if (e.target.matches('textarea')) {
                    updateCharCount();
                }
            });

            // Prompt type selection
            const promptTypeInputs = document.querySelectorAll('input[name="prompt-type"]');
            promptTypeInputs.forEach(input => {
                input.addEventListener('change', function() {
                    promptTypeInputs.forEach(inp => {
                        const span = inp.nextElementSibling;
                        span.classList.remove('bg-blue-500', 'bg-green-500', 'bg-orange-500', 'bg-purple-500', 'text-white', 'border-blue-500', 'border-green-500', 'border-orange-500', 'border-purple-500');
                        span.classList.add('border-gray-300');
                    });
                    
                    const selectedSpan = this.nextElementSibling;
                    const type = this.value;
                    let colorClass = '';
                    switch(type) {
                        case 'system': colorClass = 'bg-blue-500 text-white border-blue-500'; break;
                        case 'user': colorClass = 'bg-green-500 text-white border-green-500'; break;
                        case 'assistant': colorClass = 'bg-orange-500 text-white border-orange-500'; break;
                        case 'custom': colorClass = 'bg-purple-500 text-white border-purple-500'; break;
                    }
                    selectedSpan.className = selectedSpan.className.replace(/border-gray-300/, '') + ' ' + colorClass;
                });
            });
        });
    </script>
</body>
</html>